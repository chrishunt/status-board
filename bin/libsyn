#!/usr/bin/env ruby

require 'libsyn'

email, password, show_id, format = *(
  if ARGV.first.to_s.downcase == '--from-env'
    [ ENV['LIBSYN_EMAIL'],
      ENV['LIBSYN_PASSWORD'],
      ENV['LIBSYN_SHOW_ID'],
      ENV['LIBSYN_FORMAT'] ]
  else
    ARGV
  end)

if email && password && show_id
  stats = Libsyn::Http.new(email, password, show_id).get
  json  = Libsyn::PanicJson.new(stats)

  print format == "totals" ? json.totals : json.most_recent
else
  puts "usage: libsyn [email] [password] [show_id]"
end
